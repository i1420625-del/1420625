<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<title>é»æ“Šå°éŠæˆ²ï¼ˆé¡¯ç¤ºåˆ†æ•¸æç¤ºï¼‰</title>
<style>
body {
  text-align: center;
  font-family: Arial;
  background: #f0f8ff;
}
#info {
  font-size: 22px;
  margin: 10px;
}
button {
  padding: 10px 20px;
  font-size: 16px;
}
#gameArea {
  position: relative;
  width: 100%;
  height: 400px;
  margin-top: 20px;
  background: #e6f2ff;
  border: 2px dashed #aaa;
  overflow: hidden;
}
.box {
  position: absolute;
  border-radius: 10px;
  cursor: pointer;
  display: none;

  transition-property: left, top;
  transition-timing-function: linear;
}
#red { background: red; }
#blue { background: dodgerblue; }
#black { background: black; }

/* â­ åˆ†æ•¸æç¤º */
.scoreHint {
  position: absolute;
  font-size: 20px;
  font-weight: bold;
  color: yellow;
  text-shadow: 1px 1px 2px #000;
  pointer-events: none;
  user-select: none;
  animation: floatUp 0.5s ease-out forwards;
}

@keyframes floatUp {
  0% { opacity: 1; transform: translateY(0); }
  100% { opacity: 0; transform: translateY(-30px); }
}
</style>
</head>

<body>
<h1>ğŸ® é»æ“Šå°éŠæˆ²</h1>
<div id="info">åˆ†æ•¸ï¼š0 ï½œ æ™‚é–“ï¼š30 ï½œ ç­‰ç´šï¼š1</div>
<button onclick="startGame()">é–‹å§‹éŠæˆ²</button>

<div id="gameArea">
  <div id="red" class="box"></div>
  <div id="blue" class="box"></div>
  <div id="black" class="box"></div>
</div>

<script>
let score = 0;
let time = 30;
let level = 1;
let levelTimer;

const gameArea = document.getElementById("gameArea");
const sizeBase = 80;
const minDistance = 90;

const chars = [
  { el: red, point: 1 },
  { el: blue, point: 3 },
  { el: black, point: -2 }
];

// ç­‰ç´šè¶Šé«˜ â†’ ç§»å‹•è¶Šé »ç¹
function getMoveInterval() {
  return Math.max(1200 - level * 150, 250);
}

// ç­‰ç´šè¶Šé«˜ â†’ ç§»å‹•å‹•ç•«è¶Šå¿«
function getMoveDuration() {
  return Math.max(0.15, 0.45 - level * 0.04);
}

// ç­‰ç´šè¶Šé«˜ â†’ è§’è‰²è¶Šå°
function getSize() {
  return Math.max(sizeBase - level * 4, 40);
}

function startGame() {
  score = 0;
  time = 30;
  level = 1;
  updateInfo();

  chars.forEach(c => c.el.style.display = "block");

  clearInterval(levelTimer);

  // æ¯ 16 ç§’å‡ç´šä¸€æ¬¡
  levelTimer = setInterval(() => {
    level++;
    updateInfo();
  }, 16000);

  gameLoop();
}

function gameLoop() {
  if (time <= 0) return endGame();

  moveChars();
  time--;
  updateInfo();

  setTimeout(gameLoop, getMoveInterval());
}

function endGame() {
  clearInterval(levelTimer);
  chars.forEach(c => c.el.style.display = "none");
  alert("éŠæˆ²çµæŸï¼\nåˆ†æ•¸ï¼š" + score + "\nç­‰ç´šï¼š" + level);
}

function updateInfo() {
  document.getElementById("info").innerText =
    `åˆ†æ•¸ï¼š${score} ï½œ æ™‚é–“ï¼š${time} ï½œ ç­‰ç´šï¼š${level}`;
}

// ä¸é‡ç–Š + é€Ÿåº¦è®Šå¿«çš„ç§»å‹•
function moveChars() {
  const size = getSize();
  const areaW = gameArea.clientWidth - size;
  const areaH = gameArea.clientHeight - size;
  const positions = [];

  chars.forEach(c => {
    let x, y, safe;
    let tries = 0;

    do {
      safe = true;
      x = Math.random() * areaW;
      y = Math.random() * areaH;

      for (let p of positions) {
        if (Math.hypot(x - p.x, y - p.y) < minDistance) {
          safe = false;
          break;
        }
      }
      tries++;
    } while (!safe && tries < 50);

    positions.push({ x, y });

    c.el.style.width = size + "px";
    c.el.style.height = size + "px";

    c.el.style.transitionDuration = getMoveDuration() + "s";

    c.el.style.left = x + "px";
    c.el.style.top = y + "px";
  });
}

// â­ é»æ“ŠåŠ åˆ† + é¡¯ç¤ºåˆ†æ•¸æç¤º
chars.forEach(c => {
  c.el.onclick = (event) => {
    score += c.point;
    updateInfo();
    moveChars();

    // å‰µå»ºåˆ†æ•¸æç¤º
    const hint = document.createElement("div");
    hint.className = "scoreHint";
    hint.innerText = (c.point > 0 ? "+" : "") + c.point;

    // ä½ç½®åœ¨é»æ“Šä½ç½®é™„è¿‘
    const rect = gameArea.getBoundingClientRect();
    hint.style.left = (event.clientX - rect.left - 10) + "px";
    hint.style.top = (event.clientY - rect.top - 20) + "px";

    gameArea.appendChild(hint);

    // 0.5 ç§’å¾Œè‡ªå‹•ç§»é™¤
    setTimeout(() => {
      hint.remove();
    }, 500);
  };
});
</script>
</body>
</html>
